version: "3.7"

services:
    postgres:
        image: postgres:alpine
        env_file:
          - ./.env
        restart: always
        volumes:
          - db_data:/var/lib/postgresql/data
    web:
        build: web/
        restart: always
        env_file:
          - ./.env
        depends_on:
          - postgres
        ports:
          - "8080:8080"
        volumes:
          - ./web_panel/build:/usr/src/web/static/panel
    panel:
        build: web_panel/
        volumes:
          - ./web_panel/build:/usr/src/panel/build
          - ./web_panel/node_modules:/usr/src/panel/node_modules
          - ./web_panel/package-lock.json:/usr/src/panel/package-lock.json
          - ./web_panel/src:/usr/src/panel/src:rw

volumes:
  db_data:
  panel_build:
